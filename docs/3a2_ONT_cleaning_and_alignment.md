---
layout: default
title: Lesson 2 - Oxford Nanopore Technologies alignment
nav_order: 2
parent: 3. Tutorial
description: A comprehensive guide to understanding epigenetics.
published: true
---
{: .important-title }
> Aim
>
> Perform an alignment of Oxford Nanopore reads to the reference genome. We will compare the results obtained with this sequencing technology with the ones obtained with Illumina sequencing technology.
> 


<br>
<details open markdown="block">
  <summary>
    <strong>Table of contents</strong>
  </summary>
  {: .text-delta }
- TOC
{:toc}
</details>
<br>


During this lesson we will focus on the alignemnt of ONT reads to the reference genome. ONT sequencing enable the direct detection of methylation levels, without the need of bisulfite conversion. The alignment of the reads is performed using `minimap2`. This tool is specifically designed for long-range sequencing data and is able to handle the unique characteristics of ONT data. 

---

# 1. Prepare the filtered reads for alignment
ONT sequencing data need to be in the appropriate format (usually `fastq` or `fasta` or `bam`). The reference genome also need to be indexed appropriately using `minimap2`.

Create the index of the reference genome 

# Step 2: ALignment of reads to the reference genome 
We will use `minimap2` to align the reads to the reference genome. 



# Step 3: Extract methylation informations 
We will use `modkit` to extract the methylation informations from the aligned reads. 

## create the bedMethyl tables 
A primary use of `modkit` is to create summary counts of modified and unmodified bases in an extended bedMethyl format. bedMethyl files tabulate the counts of base modifications from every sequencing read over each aligned reference genomic position. Only **primary alignments** are used in generating the table, it is recommended to mark duplicate alignments before running as multiple primary alignments can be double counted (but the behavior is logged).

In the simples usage modkit pileup creates a bedMethyl file from a pileup file. The pileup file is generated by the alignment tool, in this case `minimap2`. The pileup file is a text file that contains the aligned reads in a tabular format. The bedMethyl file is a binary file that contains the summary counts of modified and unmodified bases. The bedMethyl file can be used to visualize the methylation pattern using tools such as IGV. 


#### Usage
```bash
modkit pileup \
--cpg \
--filter-threshold 0.75 \
--only-tabs \
--combine-mods \
--combine-strands \
--ref ${ref_path} \
--log-filepath ${out_var}/dna_methylation/modkit/${sample}/${aligner}${sample}${hap}/modkit-pileup_${aligner}${sample}${hap}combinemods_combinestrands_ft075.CG.log \
-t ${threads} \
${out_path}/${sample}/${aligner}-${snp_caller}/snp_phasing/${aligner}${sample}.${hap}.bam \
${out_var}/dna_methylation/modkit/${sample}/${aligner}${sample}${hap}/${file_name}.${aligner}${sample}${hap}_combinemods_combinestrands_ft075.CG.bedMethyl 
```

#### the options 
- `--bowtie2 bowtie2` is used as the backend (DEFAULT).


{: .success-title }
> STDOUT message
>
> Finished writing out cytosine report for covered chromosomes (processed 343 chromosomes/scaffolds in total)
>
> Now processing chromosomes that were not covered by any methylation calls in the coverage file...
>
> Writing cytosine report for not covered chromosome h1tg000079l
> Writing cytosine report for not covered chromosome h1tg000179l
> Finished writing out cytosine report (processed 345 chromosomes/scaffolds in total). coverage2cytosine processing complete.
>
> Finished generating genome-wide cytosine report!'

